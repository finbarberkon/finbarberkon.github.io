<!DOCTYPE html>
<html lang="en" dir="ltr">
   <head>
      <meta charset="utf-8">
      <title>A Ghastly Adventure</title>
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <link rel="stylesheet" href="adventure.css"/>
   </head>
   <body>
      <p id="instructions" style="color:white">
         arrow keys: move | x: shoot | z: sprint
      </p>
      <div id="player"></div>
      <script>
        // Make a ghost move around a screen and shoot fireballs
        // Written by Finbar Berkon
        // July 2019

        'use strict';

        const SPRINT = 60;
        const WALK = 30;

        const WIDTH = 75;
        const HEIGHT = 64;

        const MIN_X = 0;
        const MAX_X = window.innerWidth - WIDTH;
        const MIN_Y = 0;
        const MAX_Y = window.innerHeight - HEIGHT;

        let speed = WALK;

        const player = document.getElementById('player');
        player.style.left = "50px";
        player.style.top = (MAX_Y / 2) + "px";

        const instructions = document.getElementById("instructions");
        instructions.style.top = (MAX_Y + 15) + "px";
        instructions.style.left = (20) + "px";

        window.onload = () => {
           setInterval(() => {
              shoot();
              move();
           }, 100);
        }

        // Map key presses on keydown and remove them on keyup so that the ghost can
        // move in diagonal directions
        let key = {};

        document.addEventListener('keydown', (event) => {
           event.preventDefault(); // prevent arrow keys scrolling page
           key[event.key] = true;
           toggle_sprint();
        })

        document.addEventListener('keyup', (event) => {
           key[event.key] = false;
           toggle_sprint();
        })

        document.addEventListener('scroll', (event) => {
           event.preventDefault();
        })

        function move() {
           if (key["ArrowLeft"]) {
              let new_position = (parseInt(player.style.left) - speed);
              (new_position < MIN_X) && (new_position = MIN_X);
              player.style.left = new_position + "px";
           }

           if (key["ArrowRight"]) {
              let new_position = (parseInt(player.style.left) + speed);
              (new_position > MAX_X) && (new_position = MAX_X);
              player.style.left = new_position + "px";
           }

           if (key["ArrowUp"]) {
              let new_position = (parseInt(player.style.top) - speed);
              (new_position < MIN_Y) && (new_position = MIN_Y);
              player.style.top = new_position + "px";
           }

           if (key["ArrowDown"]) {
              let new_position = (parseInt(player.style.top) + speed);
              (new_position > MAX_Y) && (new_position = MAX_Y);
              player.style.top = new_position + "px";
           }
        }

        function shoot() {
           if (key["x"]) {
              const fireball = document.createElement('fireball');
              fireball.id = "fireball";
              fireball.style.left = (parseInt(player.style.left) + 40) + "px";
              fireball.style.top = (parseInt(player.style.top) + 20) + "px";

              document.body.appendChild(fireball);
              setTimeout(() => { document.body.removeChild(fireball); }, 2000);
           }
        }

        function toggle_sprint() {
           if (key.z) {
              speed = SPRINT;
           } else if (!key.z) {
              speed = WALK;
           }
        }
      </script>
   </body>
</html>
